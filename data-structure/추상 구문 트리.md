## 추상 구문 트리(AST)

쿼리 문서가 실제로 API로 보내질 때에 발생하는, 가장 중요한 개념 중 하나.  
대부분의 컴파일러를 통해 트랜스파일링되는 언어들이 그러하듯(대표적으로 Babel → 브라우저에 따른 트랜스파일링됨) 결국 GraphQL도 추상 구문 트리를 통해 컴퓨터가 이해할 수 있는 하나의 트리 구조로 어휘를 분석한다. 

## 어휘 분석

문자열은 추상 구문 트리로 파싱되어, 실행 전에 유효성 검사를 거친다.  
이때, 계층성을 가진 객체로 쿼리를 표현하며, 문자열은 괄호, 인자, 키워드, 콜론 모두가 독립적인 토큰으로 분해된다. 이를 어휘분석이라 한다. 이후에는 AST로 트랜스파일링을 실행하게 되는 것이다. 

## 쿼리에 대한 세부 분류

쿼리는 먼저 ‘**문서**’로 시작한다.  
이때, 쿼리에는 최소한 **정의**가 하나 이상이 들어가게 된다.

여기서 정의는 크게 2가지가 있다.

- `OperationDefinition`: 데이터 작업에 대한 정의이다. 여기에는 `mutation` `query` `subsription`이  들어간다. 그리고 각 작업 정의에는 `OperationType`과 `SelectionSet`가 들어간다.
    
- `FragmentDefinition`: 프래그먼트 정의이다.

이렇게 AST를 해석하면서 `GraphQL` 언어와 스키마를 비교하며 유효성을 검사한다.  
만약 오류가 없다면 작업이 실행되며, 아니라면 특정 에러가 반환이 되는 것이다.

결과적으로 이렇게 어휘를 tokenize하고, 어휘화된 AST를 가지고 쿼리의 세부 정의들을 살펴나가며 원하는 동작을 수행하는 것이 GraphQL의 동작 방식이라고 할 수 잇다.

따라서, AST로 가공되는 것은 GraphQL의 동작 방식에서 꼭 빼놓을 수 없는 필수 개념인 것이다.