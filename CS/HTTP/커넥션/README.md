# Connection

## TCP 커넥션

커넥션이 맺어지면 클라이언트와 서버 간 주고받은 메시지들은 손실 및 순서의 변경이 되지 않음을 보장하며 안전하게 전달된다.

예컨대 다음과 같다.

> 1. 브라우저가 호스트 명을 추출.
> 2. 브라우저가 IP 주소를 찾게 됨.
> 3. 브라우저가 포트 번호를 얻음.
> 4. 브라우저가 해당 IP의 포트로 TCP 커넥션 생성.
> 5. 브라우저가 서버로 요청 메시지를 보냄.
> 6. 브라우저가 서버에서 온 메시지를 읽음.
> 7. 브라우저가 커넥션을 끊음.

## 신뢰할 수 있는 TCP

`TCP 커넥션`은 인터넷을 안정적으로 연결하는 데 사용한다.  
커넥션의 한 쪽에 위치한 바이트들은 반대족으로 전달되는데, 그 순서를 보장한다.

### 세그먼트

만약 데이터가 크면 어떨까? 그래도 괜찮다.  
TCP는 IP 패킷이라 불리는 작은 조각을 통해 데이터를 전송한다.  
`HTTP`는 프로토콜 스택에서 최상위 계층이며, `HTTPS`는 `SSL`으로써 `HTTP`와 `TCP` 사이에 있는 암호화 계층이다.

만약 메시지를 전송하고자 하면, `TCP 커넥션`이 메시지 내용을 순서대로 보내되, `TCP`가 데이터를 잘게 나누어 IP 패킷에 담아 데이터를 전달한다.

이는 `TCP/IP SW`에 의해 처리되며, 과정을 프로그래머가 알 수 없도록 은닉화되어 있다.

## TCP 소켓 프로그래밍

소켓 API는 유닉스 운영체제 용으로 개발되었으나 현제는 다양한 구현체 덕에 대부분의 OS와 프로그램 언어에서 사용 가능하다.  

`소켓 API`를 사용할 때, TCP 종단 데이터 구조가 생성된다.  
이후 종단에 그 종단 데이터 구조를 연결하여 데이터 스트림을 읽고 쓸 수 있다.  

이후 `TCP API`가 핸드셰이킹, TCP 데이터 스트림, IP 패킷 분할 및 재조립에 대한 세부사항을 은닉화하는 원리이다.

이는 다음과 같은 순서로 진행된다.

> 서버측 - 새로운 소켓 생성
> 서버측 - 특정 포트로 소켓 묶음
> 서버측 - 소켓 커넥션 허가
> 서버측 - 커넥션 대기
> 클라이언트측 - IP 주소, 포트 획득
> 클라이언트측 - 소켓 생성
> 클라이언트측 - 서버 IP 포트로 연결
> 서버측 - 애플리케이션 커넥션 통지
> 서버측 -  요청 읽기 시작
> 클라이언트측 - 성공적으로 연결
> 클라이언트측 - HTTP 요청 보냄
> 클라이언트측 - HTTP 응답 대기
> 서버측 - HTTP 요청 메시지 처리
> 서버측 - HTTP 응답 보냄.
> 클라이언트 측 - HTTP 응답 처리
> 커넥션 닫음.

