# SNAT와 DNAT

+ SNAT(Source NAT): 출발지 주소를 변경하는 NAT이다.
+ DNAT(Destination NAT): 도착지 주소를 변경하는 NAT이다.

![image](https://user-images.githubusercontent.com/78713176/223913353-a15d80d8-5f5a-4a69-8675-e937a823e534.png)

## 구분 기준

물리적으로는 트래픽이 출발하는 시작 지점을 기준으로 구분한다.  
논리적으로는 서비스 흐름과 목적에 따라 어떤 주소를 변경해야 하는지를 결정한다.  

예컨대 SNAT를 통해 출발지를 바꾸었다는 것은, 응답 시 DNAT를 해야 한다는 것을 의미한다.  
그렇기에 SNAT 설정을 해주면 시작 지점의 의도에 맞게 주소 교환이 수행된다.  
이처럼 DNAT로 다시 변환되는 과정을 **역 NAT**라 하며, NAT의 동작 과정에는 항상 이 역 NAT를 고려해야 한다.

## 필요성

### SNAT

![image](https://user-images.githubusercontent.com/78713176/223913440-2e958f53-960f-4c6c-8110-525cbbe374af.png)

#### 사설에서 공인으로 통신할 때

공인 대역에서는 사설 대역으로의 경로를 알 수 없다.  
따라서 출발지에서 사설 IP를 공인 IP로 교환한다. (마치 공유기처럼 PAT를 사용한다.)

#### 보안상으로 사용할 때

별도의 다른 IP로 전송함으로써 대외 네트워크로부터 실제 IP 주소를 은닉화할 수 있다.  
또한, 사내 IP 주소가 대외사 사내 IP 주소와 충돌할 때에도 중복되지 않는 다른 IP를 사용함으로써 해결할 수 있다.

#### 로드밸런서 구성에 따라 사용할 때

출발지와 목적지 서버가 동일하면 로드 밸런서를 거치지 않고 응답 가능하다.  
SNAT를 통해 응답 트래픽이 로드 밸런서를 거치게 할 수 있다.

### DNAT

![image](https://user-images.githubusercontent.com/78713176/223913524-dd3df3ad-41f0-4aac-8c82-4954c1a3eb52.png)

#### 로드밸런서

서비스 요청을 위해 로드 밸런서에 설정된 가상의 서비스 IP (Virtual IP)로 요청, 로드 밸런서는 서비스 VIP를 로드 밸런싱될 서버의 실제 IP로 DNAT하여 내보낸다.  
(쉽게 생각하면, 로드 밸런서처럼 일종의 프록시 같은 서버가 중간에 끼워져 있을 때 실 주소로 바꾸기 위해 DNAT를 하는 것이다.)

#### 사내가 아닌 대외망과의 네트워크를 구성할 때

대외망과 연동 시 IP는 대외망 간에 중복될 수 있다. 이때 신규 대외사와의 연동마다 IP를 개별적으로 설정해주는 것이다.  
사내에서는 어떤 대외사든 대외망 전용 NAT 대역으로 변경된 네트워크 대역으로 라우팅을 처리하기 때문에 대외사 추가에 따라 별도 라우팅을 개별적으로 설정하지 않아도 된다.
