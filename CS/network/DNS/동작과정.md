# DNS 동작 과정

1. 사용자가 도메인 주소를 사용하여 서비스 요청
2. DNS에 해당 도메인 주소에 대한 쿼리를 보내면
3. 결과값으로 요청한 도메인 서비스 IP 주소 할당 받음.

![image](https://user-images.githubusercontent.com/78713176/223916917-57ee40e1-24a9-4dca-9c93-438972fc4896.png)

---

## 세부 동작 설명

### DNS 서버 없이 로컬에 있는 DNS 캐시 정보 확인

![image](https://user-images.githubusercontent.com/78713176/223919750-90268a2c-8fba-44e8-9b6f-f8da61c80280.png)


로컬에서 도메인과 IP주소를 직접 설정해 관리할 수도 있다.  
이러한 관리하는 파일을 `hosts file`이라 명명하는데, 이 파일에서 조회하여 캐싱된 도메인 정보가 있는지 탐색한다.

![image](https://user-images.githubusercontent.com/78713176/223919705-6308b0bd-ddec-4953-9ac7-65a189328949.png)

### DNS 탐색

로컬에 없다면 본격적으로 DNS 시스템은 도메인에 대한 결과값을 보내주기 위해 DNS들을 탐색하게 된다.

이때, DNS는 분산된 데이터베이스로 서로 원하는 결과값을 조회할 수 있도록 도와준다.  
DNS 기능을 서버에 올리면 DNS는 기본적으로 루트 DNS 관련 정보를 갖고 있다. 만약 로컬에 없다면 루트 DNS에 쿼리하여 TLD 값을 탐색한다.  

이후 상위 DNS에서 하위 DNS로 차례로 쿼리를 보내며 최종 결과값을 전달한다.

이때, 쿼리 방식은 크게 2가지이다.
+ 재귀적 쿼리: 호스트가 DNS 서버에 대상 도메인의 리소스 레코드의 정보를 달라고 요청하는 질의
+ 반복적 쿼리: 상위 도메인에서 하위 도메인으로 각 네임서버가 응답하는 정보에 따라 순차적으로 반복하여 질의하는 방식

![image](https://user-images.githubusercontent.com/78713176/223923595-296581d5-41cb-4c29-b441-5bfea79b59d2.png)

### 응답

DNS는 네임 서버에서 쿼리를 통해 얻어낸 정보를 응답한다.

### 캐시 저장

해당 레코드에 대한 정보를 로컬 캐시에 저장하고, 사용자 호스트에 정보를 응답한다.

### 리소스 접근

사용자는 응답받은 IP 정보를 이용하여 해당 리소스에 접근한다.