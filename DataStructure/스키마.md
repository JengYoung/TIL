
## 스키마 설계하기

GraphQL을 사용하면 이제는 엔드포인트의 집합이 아닌, 타입 집합으로 관점이 바뀌게 된다.

이때, API를 만들기 전에는 반드시

1. 반환할 데이터 타입을 정하고
2. 개발자들과 토론하고
3. 이를 제대로 정의하는 것이 가장 중요하다.

이러한 과정에서 탄생한 **데이터 타입 집합을 GraphQL은 스키마**라고 정의한다.

## 스키마 우선주의

데이터 타입을 팀원간 같은 선상에서 이해하도록 하는 디자인 방법론이다.

확실히 정의된 용어를 가지고 만들 수 있는 시스템을 토의함으로써 ‘함께’ 일할 수 있도록 하는 것이다.

## SDL

GraphQL은 스키마 정의를 위해 SDL(Schema Definition Language)를 지원한다.

사용법은 쿼리 언어처럼 어떠한 프로그래밍 언어, 프레임워크 상관 없이 동일하다.

## 타입 정의하기

결국 핵심은 타입이다. GraphQL의 핵심 단위이기 때문이다.

타입은 커스텀 객체이며 애플리케이션의 기능을 엿볼 수 있다.

예컨대 대개 소셜 미디어 애플리케이션이라면 `Users` / `Posts` 로 구성된다. 

또한 블로그라면 `Categories` / `Articles`로 구성된다. 

즉, 타입은 애플리케이션 데이터를 상징한다. 이는 팀의 색깔을 드러낼 수밖에 없으며, 팀간의 도메인 객체에 관한 이야기 속에서 함께 사용할 공통의 언어를 정의하는 것과 상통한다. 

타입에는 필드가 들어가며, 각각의 필드는 특정 동류의 데이터를 반환한다. 이는 스칼라 타입일 수도, 커스텀 객체 타입일 수도 있다. 

스키마에는 타입 정의를 모아두며, **텍스트 파일의 주요 확장자는  `.graphql`**이다. 

또한, **자바스크립트 파일에 문자열로도 작성 가능**하다. 

다음과 같이 `Photo` 타입을 정의해보자.

```graphql
type Photo {
  id: ID!
  name: String!
  url: String!
  description: String
}
```

여기서 `!`의 의미는 `null` 값을 허용하지 않는다는 의미이다. 다라서 쿼리가 오면 반드시 데이터를 반환해야 한다. 

`ID` 스칼라 타입은 고유 식별자 값이 반환되어야 하는 곳에 쓰면 된다.

## 스칼라타입

스칼라 타입을 직접 만들 수도 있다.

스칼라 타입은 객체 타입이 아니므로 필드를 가지지 않지만, 커스텀 스칼라 타입의 유효성 검사 방식을 지정할 수는 있다.

```graphql
scalar DateTime

type Photo {
  id: ID!
  name: String!
  url: String!
  description: String
	created: DateTime!
}
```

여기서 `DateTime`으로 지정된 필드는 JSON으로 값이 반환된다.

이때, 커스텀 스칼라 타입을 사용하면 값이 직렬화와 유효성 검사를 거쳤는지, 형식이 맞춰졌는지 검사할 수 있다. 

따라서, 유효성 검사가 필요한 타입 → 커스텀 스칼라 타입을 사용하면 된다.

대표적인 패키지로는 `graphql-custom-type`이 있다. 

## 열거 타입

열거 타입은 스칼라 타입에 속하며, 미리 반환할 문자열 값을 세트로 지정할 수 있다.

**정의해둔 세트에 속하는 값만 필드에서 반환하도록 할 때 사용**한다.

```graphql
enum PhotoCategory {
	SELFIE
	PORTRAIT
	ACTION
	LANDSCAPE
	GRAPHIC
}
```

필드를 열거 타입으로 만들면 다음과 같다.

```graphql
type Photo {
	id: ID!
	name: String!
	url: String!
	description: String
	created: DateTime!
	category: PhotoCategory!
}
```

만약 이제 카테고리 필드에 대한 요청이 발생한다면, 미리 정의한 다섯 가지 타입 중 하나가 반환될 것이다.

## 연결과 리스트

리스트는 GraphQL 타입을 대괄호로 감싸서 만든다. 

`[String]`은 문자열 리스트를 의미하며 `[PhotoCategory]`는 카테고리 5가지 타입으로 이루어진 리스트를 의미한다.

여기서 주의할 것은 `!` 이다.

- 닫는 대괄호 다음에 느낌표를 쓰면 필드에서 `null` 값을 반환할 수 없다는 의미지만
- 닫는 대괄호 앞에 오면 리스트에 담긴 값 자체가 `null` 값이 될 수 없다는 의미이다.

`null`의 경우 정말 올 일이 드물기 때문에, 데이터를 걸러내는 작업 중 가장 먼저 해야 할 것은 `null` 값에 대한 예외 허용 여부 처리이다.

이러한 리스트를 가지고, 이후에 객체 타입을 연결할 수 있다.