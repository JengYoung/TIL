# 중재자 패턴

+ 서로 다른, 또는 유사한 일을 하는 협력자들의 커뮤니케이션의 결합도 및 복잡도를 낮추기 위해 사용하는 패턴이다.
+ 이들을 조직하여 전체 성과를 끌어내는 단일 중재자로 이루어진 패턴이다.

가장 순수한 형태의 중재자는 별다른 비즈니스 로직 없이 협력자 사이의 움직임만 제어한다.  
결과적으로 커플링이 감소한 협력자들의 관계는 재사용성 및 확장성을 증대할 수 있는 장점이 발생한다.

## 조건

어떻게 보면 멋진 패턴이지만, 자칫 무작위로 사용하면 중재자가 방대해질 위험도 존재한다.  
따라서 다음과 같은 때에 사용을 고려하자.

+ 객체 사이의 관계들이 너무 많이 얽혀 있어 다이어그램이 복잡해질 경우
+ 객체 사이의 상호관계가 복잡성이 높을 때

> 즉, 객체 관계에서의 커플링을 낮추는 방식으로 충분히 고려할 만한 패턴이다.


## 옵저버 패턴과의 차이

사실 둘은 굉장히 긴밀히 연관되어 있다.  
객체간의 상태를 서로 알려준다는 점에서는 상당히 유사한데, 차이점이라면 관계에 있다.  

옵저버 패턴은 결국 1:N 관계를 유지한다. 즉 구독자는 여러명인데, 발행자는 단 한 명으로 유지하는 패턴이다.

하지만 중재자 패턴의 경우에는 M:N의 관계이다. 즉, 많은 발행자가 존재하고, 또 발행자의 상태를 관찰하는 많은 관찰자가 존재한다.

## 장점

### 객체 간 커뮤니케이션의 디커플링

객체들의 이해관계가 복잡해질 수록 코드를 이해하기 어려워진다. 중재자 패턴은 이러한 복잡한 관계를 하나의 중재자가 제어해주기 때문에 좀 더 구조를 이해하기 편해지는 장점이 존재한다.

### 의존성 역전 원칙 준수

객체간 커뮤니케이션이 강하게 결합되어 있으면, 하나의 객체의 문제가 발생하면 다른 객체 역시 수정을 가해야 한다. 그리고 이러한 커뮤니케이션의 여파가 강할 수록 골치가 아파진다. (관계가 매우 복잡할 때)

하지만 이에 반해 중재자는 협력자와 연결을 통해 상태를 관찰하고, 원하는 로직을 추가시킬 수도 있다.  
즉, 고수준 모듈(단일 책임의 객체)의 기능이 절대적으로 문제가 발생하지 않는다면 이를 폐쇄적으로 유지보수가 가능하므로 의존성 역전 원칙을 준수할 수 있다.


## 단점

### 재사용성이 떨어진다

하나의 중재자는 여러 단일 객체의 책임들을 한데 제어하고 있다.  
따라서 협력자들의 책임 정도에 따라 특정 애플리케이션의 비즈니스 로직과 긴밀하게 결합할 수밖에 없어진다.  
따라서 비즈니스와의 접착이 강해지므로, 다른 로직에서 사용할 때에는 상대적으로 재사용성이 떨어질 수밖에 없다.

### 중재자의 권한이 너무 커진다

결과적으로 모든 로직들이 하나의 중재자를 거치게 된다는 것은, 중재자에서의 문제가 발생하면 발생하는 여파 역시 상당히 크게 발생하는 문제가 발생한다.  
따라서 설계할 때 이 중재자가 어느 정도의 권한을 가져야 하는지를 적절히 판단하여 적당히 인터페이스를 분리해야 한다.

## 주의사항

### 흐름을 잘 관찰하자

결과적으로 커뮤니케이션이 한 곳에 흘러들어오면서, 예기치 않은 사이드 이펙트가 발생한다.  
대표적으로 구독/발행 순서에서 발생하는 결함이 있겠다. 이러한 사이드 이펙트를 충분히 고려하며 디커플링을 진행해야 안정성 높은 중재자 패턴을 설계할 수 있을 것 같다.